{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2021-04-03 14:48:32.049270",
 "css": ".print-format {\r\n    font-size: 10pt;\r\n    padding: 0.5in;\r\n}\r\n\r\n.print-heading {\r\n    text-align: center;\r\n    padding-bottom: 5px;\r\n}\r\n\r\nhr {\r\n    margin-top: 10px;\r\n    margin-bottom: 5px;\r\n}\r\n\r\ntable {\r\n    font-size: 11px;\r\n}\r\n\r\n.print-format td, .print-format th {\r\n    padding: 2px !important;\r\n}\r\n\r\n@media print {\r\n    #footer-html {\r\n        display: flex;\r\n        flex-direction: column;\r\n    }\r\n}",
 "custom_format": 0,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Patient Appointment",
 "docstatus": 0,
 "doctype": "Print Format",
 "font": "Default",
 "format_data": "[{\"fieldname\": \"print_heading_template\", \"fieldtype\": \"Custom HTML\", \"options\": \"<hr>\\n<div class=\\\"print-heading\\\">\\n    <h2 class=\\\"text-center\\\">Itemized Bill</h2>\\n</div>\"}, {\"fieldtype\": \"Section Break\", \"label\": \"Patient Information\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"patient\", \"print_hide\": 0, \"label\": \"Patient\"}, {\"fieldname\": \"patient_name\", \"print_hide\": 0, \"label\": \"Patient Name\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"appointment_type\", \"print_hide\": 0, \"label\": \"Appointment Type\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"<div class=\\\"row  data-field\\\" data-fieldname=\\\"patient\\\" data-fieldtype=\\\"Link\\\">\\r\\n\\t<div class=\\\"col-xs-5\\\">\\r\\n    \\t<label>Appointment Date</label>\\r\\n    </div>\\r\\n    <div class=\\\"col-xs-7 value\\\">\\r\\n        {{ frappe.utils.get_datetime(doc.appointment_date).strftime('%d-%b-%Y')  }}\\r\\n\\t</div>\\r\\n</div>\"}, {\"fieldtype\": \"Section Break\", \"label\": \"Insurance or Company Information\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"insurance_company\", \"print_hide\": 0, \"align\": \"left\", \"label\": \"Insurance\"}, {\"fieldname\": \"coverage_plan_name\", \"print_hide\": 0, \"align\": \"left\", \"label\": \"Coverage Name\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"authorization_number\", \"print_hide\": 0, \"align\": \"left\", \"label\": \"Authorization No\"}, {\"fieldname\": \"coverage_plan_card_number\", \"print_hide\": 0, \"align\": \"left\", \"label\": \"Card Number\"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{% set inpatient_id = frappe.db.get_value('Patient Encounter', {'appointment' : doc.name}, 'inpatient_record') %}\\r\\n{% if inpatient_id %}\\r\\n    <div class=\\\"row  data-field\\\" data-fieldname=\\\"patient\\\" data-fieldtype=\\\"Link\\\">\\r\\n    \\t<div class=\\\"col-xs-5\\\">\\r\\n        \\t<label>Admission Date</label>\\r\\n        </div>\\r\\n        <div class=\\\"col-xs-7 value\\\">\\r\\n            {% set admitted_datetime = frappe.db.get_value('Inpatient Record', inpatient_id, 'admitted_datetime')  %}\\r\\n            {% if admitted_datetime %}            \\r\\n                {{ frappe.utils.get_datetime(admitted_datetime).strftime('%d-%b-%Y') }}\\r\\n            {% endif %}\\r\\n    \\t</div>\\r\\n    </div>\\r\\n{% endif %}\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{% set inpatient_id = frappe.db.get_value('Patient Encounter', {'appointment' : doc.name}, 'inpatient_record') %}\\r\\n{% if inpatient_id %}\\r\\n<div class=\\\"row  data-field\\\" data-fieldname=\\\"patient\\\" data-fieldtype=\\\"Link\\\">\\r\\n\\t<div class=\\\"col-xs-5\\\">\\r\\n    \\t<label>Discharge Date</label>\\r\\n    </div>\\r\\n    <div class=\\\"col-xs-7 value\\\">\\r\\n        {{ frappe.utils.get_datetime(frappe.db.get_value('Inpatient Record', inpatient_id, 'discharge_date')).strftime('%d-%b-%Y')  }}\\r\\n\\t</div>\\r\\n</div>\\r\\n{% endif %}\"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{######## OPD CASH ITEMIZED BILL ########}\\r\\n{% if doc.mode_of_payment %}\\r\\n   {% if doc.status == \\\"Closed\\\" %}\\r\\n        {% set encounter_list = frappe.db.get_all(\\\"Patient Encounter\\\", filters={'appointment' : doc.name }, fields=['name']) %}\\r\\n        {% set encounter_string = (encounter_list[:encounter_list|length]|join(\\\",\\\",attribute=\\\"name\\\")) %}\\r\\n        \\r\\n        {% set bill = [] %}\\r\\n        {% set inpatient_id_list = frappe.db.get_all('Inpatient Record', filters={'admission_encounter': ['in', encounter_string]}, fields=['name'], page_length=1) %}\\r\\n        \\r\\n        {% if not inpatient_id_list%}\\r\\n            {% if not doc.follow_up %}\\r\\n                  {% set item_date = frappe.utils.formatdate(doc.appointment_date, 'dd-mmmm-yyyy') %}\\r\\n                  {% set item_category = frappe.db.get_value('Item', doc.billing_item, 'item_group') %}\\r\\n                  {% set _ = bill.append({\\\"date\\\": item_date, \\\"category\\\": item_category, \\\"item_name\\\": doc.billing_item , \\\"quantity\\\": 1,  'item_rate': doc.paid_amount, \\\"amount\\\": doc.paid_amount }) %}\\r\\n            {% endif %}\\r\\n            \\r\\n            {##### LAB TEST #####}\\r\\n            {% set lab_presc = frappe.db.get_all(\\\"Lab Prescription\\\", filters={'parent': ['in', encounter_string], 'prescribe': 1, 'is_not_available_inhouse': 0}, fields=['lab_test_code', 'lab_test_name', 'amount', 'creation']) %}\\r\\n            {% for lab in lab_presc %}\\r\\n                    {% set date = frappe.utils.formatdate(lab.creation, 'dd-mmmm-yyyy') %}\\r\\n                    {% set category = frappe.db.get_value(\\\"Lab Test Template\\\", lab.lab_test_code, ['lab_test_group']) %}\\r\\n                    {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": lab.lab_test_code , \\\"quantity\\\": 1, 'item_rate': lab.amount, \\\"amount\\\": lab.amount }) %}\\r\\n            {% endfor %}\\r\\n    \\r\\n            {##### RADIOLOGY EXAMINATION #####}\\r\\n            {% set rad_exams = frappe.db.get_all(\\\"Radiology Procedure Prescription\\\", filters={'parent': ['in', encounter_string], 'prescribe': 1, 'is_not_available_inhouse': 0}, fields=['radiology_examination_template', 'radiology_procedure_name', 'amount', 'creation'] ) %}\\r\\n            {% for rad in rad_exams %}\\r\\n                   {% set date = frappe.utils.formatdate(rad.creation, 'dd-mmmm-yyyy') %}\\r\\n                   {% set category = frappe.db.get_value(\\\"Radiology Examination Template\\\", rad.radiology_examination_template, ['item_group']) %}\\r\\n                   {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": rad.radiology_examination_template , \\\"quantity\\\": 1, 'item_rate': rad.amount, \\\"amount\\\": rad.amount }) %}\\r\\n            {% endfor %}\\r\\n    \\r\\n            {##### CLINICAL PROCEDURE #####}\\r\\n            {% set proc_presc = frappe.db.get_all(\\\"Procedure Prescription\\\", filters={'parent': ['in', encounter_string], 'prescribe': 1, 'is_not_available_inhouse': 0}, fields=['procedure', 'procedure_name', 'amount', 'creation'] ) %}\\r\\n            {% for clin in proc_presc %}\\r\\n                    {% set date = frappe.utils.formatdate(clin.creation, 'dd-mmmm-yyyy') %}\\r\\n                    {% set category = frappe.db.get_value(\\\"Clinical Procedure Template\\\", clin.procedure, ['item_group']) %}\\r\\n                    {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": clin.procedure_name , \\\"quantity\\\": 1, 'item_rate': clin.amount, \\\"amount\\\": clin.amount }) %}\\r\\n            {% endfor %}\\r\\n    \\r\\n            {##### MEDICATION #####}\\r\\n             {% set drug_presc = frappe.db.get_all(\\\"Drug Prescription\\\", filters={'parent': ['in', encounter_string], 'prescribe': 1, 'is_not_available_inhouse': 0}, fields=['drug_code', 'drug_name', 'amount', 'quantity', 'creation'] ) %}\\r\\n            {% for drug in drug_presc %}\\r\\n                    {% set date = frappe.utils.formatdate(drug.creation, 'dd-mmmm-yyyy') %}\\r\\n                    {% set amount2 = (drug.quantity * drug.amount) %}\\r\\n                    {% set category = frappe.db.get_value(\\\"Medication\\\", drug.drug_code, ['item_group']) %}\\r\\n                    {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": drug.drug_code , \\\"quantity\\\": drug.quantity,  'item_rate': drug.amount, \\\"amount\\\": amount2 }) %}\\r\\n            {% endfor %}\\r\\n    \\r\\n            {##### THERAPIES #####}\\r\\n            {% set ther_plan = frappe.db.get_all(\\\"Therapy Plan Detail\\\", filters={'parent': ['in', encounter_string], 'prescribe': 1, 'is_not_available_inhouse': 0}, fields=['therapy_type', 'amount', 'creation'] ) %}\\r\\n            {% for ther in ther_plan %}\\r\\n                    {% set date = frappe.utils.formatdate(ther.creation, 'dd-mmmm-yyyy') %}\\r\\n                    {% set category = frappe.db.get_value(\\\"Therapy Type\\\", ther.therapy_type, ['item_group']) %}\\r\\n                    {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": ther.therapy_type , \\\"quantity\\\": 1,  'item_rate': ther.amount, \\\"amount\\\": ther.amount }) %}\\r\\n            {% endfor %}\\r\\n            \\r\\n            \\r\\n             <TABLE border=1 style=\\\"width: 100%; border-collapse: collapse; border: 1px grey; margin-bottom: 10px;\\\">\\r\\n                <COLGROUP>\\r\\n                   <COL WIDTH=\\\"5%\\\">\\r\\n                   <COL WIDTH=\\\"11%\\\">\\r\\n                   <COL WIDTH=\\\"25%\\\">\\r\\n                   <COL WIDTH=\\\"36%\\\">\\r\\n                   <COL WIDTH=\\\"5%\\\">\\r\\n                   <COL WIDTH=\\\"8%\\\">\\r\\n                   <COL WIDTH=\\\"15%\\\">    \\r\\n                </COLGROUP>\\r\\n                <THEAD style=\\\"background-color: darkgray;\\\">\\r\\n                   <TR>\\r\\n                      <TH style=\\\"text-align: center;\\\">&nbsp;</TH>\\r\\n                      <TH style=\\\"text-align: center;\\\">Date</TH>\\r\\n                      <TH style=\\\"text-align: center;\\\">Category</TH>\\r\\n                      <TH style=\\\"text-align: center;\\\">Description</TH>\\r\\n                      <TH style=\\\"text-align: center;\\\">Qty</TH>\\r\\n                      <TH style=\\\"text-align: center;\\\">Rate</TH>\\r\\n                      <TH style=\\\"text-align: center;\\\">Amount</TH>        \\r\\n                   </TR>\\r\\n                </THEAD>\\r\\n                <TBODY>\\r\\n                   {% set total = [0] %}\\r\\n                   {% for item in bill %}\\r\\n                      {% set total = total.append(total.pop() + item.amount) %}\\r\\n                      <TR>\\r\\n                         <TD style=\\\"text-align: center;\\\">{{ loop.index }}</TD>\\r\\n                         <TD style=\\\"text-align: center;\\\">{{ frappe.utils.formatdate(item.date, \\\"dd-MMM-yyyy\\\") }}</TD>\\r\\n                         <TD style=\\\"text-align: left;\\\">{{ item.category }}</TD>\\r\\n                         <TD style=\\\"text-align: left;\\\">{{ item.item_name }}</TD>\\r\\n                         <TD style=\\\"text-align: center;\\\">{{ item.quantity|int }}</TD>\\r\\n                         <TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(item.item_rate) }}</TD>\\r\\n                         <TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(item.amount, precision=0) }}</TD>\\r\\n                      </TR>\\r\\n                   {% endfor %}\\r\\n                </TBODY>\\r\\n                <TFOOT>\\r\\n                   <TR>\\r\\n                      <TD style=\\\"text-align: center;\\\">&nbsp;</TD>\\r\\n                      <TD style=\\\"text-align: left;\\\" colspan=\\\"5\\\">TOTAL</TD>\\r\\n                      <TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(total[0], precision=0) }}</TD>\\r\\n                      \\r\\n                   </TR> \\r\\n                </TFOOT>\\r\\n             </TABLE>\\r\\n        {% endif %}\\r\\n   {% else %}\\r\\n      This appointment is not closed\\r\\n   {% endif %}\\r\\n{% endif %}\"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{##### IPD CASH ITEMIZED BILL #####}\\r\\n{% if doc.mode_of_payment %}\\r\\n   {% if doc.status == \\\"Closed\\\" %}\\r\\n        {% set encounter_list = frappe.db.get_all(\\\"Patient Encounter\\\", filters={'appointment' : doc.name }, fields=['name']) %}\\r\\n        {% set encounter_string = (encounter_list[:encounter_list|length]|join(\\\",\\\",attribute=\\\"name\\\")) %}\\r\\n        \\r\\n        {% set bill = [] %}\\r\\n        {% set inpatient_id_list = frappe.db.get_all('Inpatient Record', filters={'admission_encounter': ['in', encounter_string]}, fields=['name'], page_length=1) %}\\r\\n        \\r\\n        {% if  inpatient_id_list%}\\r\\n            {% set inpatient_id = inpatient_id_list[0].name %}\\r\\n\\r\\n            {% if not doc.follow_up %}\\r\\n                  {% set item_date = frappe.utils.formatdate(doc.appointment_date, 'dd-mmmm-yyyy') %}\\r\\n                  {% set item_category = frappe.db.get_value('Item', doc.billing_item, 'item_group') %}\\r\\n                  {% set _ = bill.append({\\\"date\\\": item_date, \\\"category\\\": item_category, \\\"item_name\\\": doc.billing_item , \\\"quantity\\\": 1,  'item_rate': doc.paid_amount, \\\"amount\\\": doc.paid_amount }) %}\\r\\n            {% endif %}\\r\\n             \\r\\n             \\r\\n            {##### LAB TEST #####}\\r\\n            {% set lab_presc = frappe.db.get_all(\\\"Lab Prescription\\\", filters={'parent': ['in', encounter_string], 'prescribe': 1, 'is_not_available_inhouse': 0}, fields=['lab_test_code', 'lab_test_name', 'amount', 'creation']) %}\\r\\n            {% for lab in lab_presc %}\\r\\n                    {% set date = frappe.utils.formatdate(lab.creation, 'dd-mmmm-yyyy') %}\\r\\n                    {% set category = frappe.db.get_value(\\\"Lab Test Template\\\", lab.lab_test_code, ['lab_test_group']) %}\\r\\n                    {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": lab.lab_test_code , \\\"quantity\\\": 1, 'item_rate': lab.amount, \\\"amount\\\": lab.amount }) %}\\r\\n            {% endfor %}\\r\\n    \\r\\n            {##### RADIOLOGY EXAMINATION #####}\\r\\n            {% set rad_exams = frappe.db.get_all(\\\"Radiology Procedure Prescription\\\", filters={'parent': ['in', encounter_string], 'prescribe': 1, 'is_not_available_inhouse': 0}, fields=['radiology_examination_template', 'radiology_procedure_name', 'amount', 'creation'] ) %}\\r\\n            {% for rad in rad_exams %}\\r\\n                   {% set date = frappe.utils.formatdate(rad.creation, 'dd-mmmm-yyyy') %}\\r\\n                   {% set category = frappe.db.get_value(\\\"Radiology Examination Template\\\", rad.radiology_examination_template, ['item_group']) %}\\r\\n                   {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": rad.radiology_examination_template , \\\"quantity\\\": 1, 'item_rate': rad.amount, \\\"amount\\\": rad.amount }) %}\\r\\n            {% endfor %}\\r\\n    \\r\\n            {##### CLINICAL PROCEDURE #####}\\r\\n            {% set proc_presc = frappe.db.get_all(\\\"Procedure Prescription\\\", filters={'parent': ['in', encounter_string], 'prescribe': 1, 'is_not_available_inhouse': 0}, fields=['procedure', 'procedure_name', 'amount', 'creation'] ) %}\\r\\n            {% for clin in proc_presc %}\\r\\n                    {% set date = frappe.utils.formatdate(clin.creation, 'dd-mmmm-yyyy') %}\\r\\n                    {% set category = frappe.db.get_value(\\\"Clinical Procedure Template\\\", clin.procedure, ['item_group']) %}\\r\\n                    {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": clin.procedure_name , \\\"quantity\\\": 1, 'item_rate': clin.amount, \\\"amount\\\": clin.amount }) %}\\r\\n            {% endfor %}\\r\\n    \\r\\n            {##### MEDICATION #####}\\r\\n             {% set drug_presc = frappe.db.get_all(\\\"Drug Prescription\\\", filters={'parent': ['in', encounter_string], 'prescribe': 1, 'is_not_available_inhouse': 0}, fields=['drug_code', 'drug_name', 'amount', 'quantity', 'creation'] ) %}\\r\\n            {% for drug in drug_presc %}\\r\\n                    {% set date = frappe.utils.formatdate(drug.creation, 'dd-mmmm-yyyy') %}\\r\\n                    {% set amount2 = (drug.quantity * drug.amount) %}\\r\\n                    {% set category = frappe.db.get_value(\\\"Medication\\\", drug.drug_code, ['item_group']) %}\\r\\n                    {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": drug.drug_code , \\\"quantity\\\": drug.quantity,  'item_rate': drug.amount, \\\"amount\\\": amount2 }) %}\\r\\n            {% endfor %}\\r\\n    \\r\\n            {##### THERAPIES #####}\\r\\n             {% set ther_plan = frappe.db.get_all(\\\"Therapy Plan Detail\\\", filters={'parent': ['in', encounter_string], 'prescribe': 1, 'is_not_available_inhouse': 0}, fields=['therapy_type', 'amount', 'creation'] ) %}\\r\\n            {% for ther in ther_plan %}\\r\\n                    {% set date = frappe.utils.formatdate(ther.creation, 'dd-mmmm-yyyy') %}\\r\\n                    {% set category = frappe.db.get_value(\\\"Therapy Type\\\", ther.therapy_type, ['item_group']) %}\\r\\n                    {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": ther.therapy_type , \\\"quantity\\\": 1,  'item_rate': ther.amount, \\\"amount\\\": ther.amount }) %}\\r\\n            {% endfor %}\\r\\n    \\r\\n             {##### IPD BED CHARGES #####}\\r\\n             {% set bed_charges = frappe.db.get_all(\\\"Inpatient Occupancy\\\", filters={'is_confirmed': 1, 'parent': inpatient_id}, fields=['check_in', 'service_unit', \\\"amount\\\"], order_by='check_in asc') %}    \\r\\n             {% for item in bed_charges %}\\r\\n                {% set hsu = frappe.db.get_value('Healthcare Service Unit', item.service_unit, 'service_unit_type') %}\\r\\n                {% set item_category = frappe.db.get_value('Healthcare Service Unit Type', hsu, 'item_group') %}\\r\\n                {% set _ = bill.append({ \\\"date\\\": item.check_in, \\\"category\\\": item_category, \\\"item_name\\\": item.service_unit, \\\"quantity\\\": 1, \\\"item_rate\\\": item.amount, \\\"amount\\\": item.amount  }) %}\\r\\n             {% endfor %}\\r\\n    \\r\\n             {##### IPD BED CONS #####}\\r\\n             {% set ipd_cons = frappe.db.get_all(\\\"Inpatient Consultancy\\\", filters={'is_confirmed': 1, 'parent': inpatient_id}, fields=['date', 'consultation_item','rate'], order_by='date asc') %}\\r\\n             {% for item in ipd_cons %}\\r\\n                {% set item_category = frappe.db.get_value('Item', item.consultation_item, 'item_group') %}\\r\\n                {% set _ = bill.append({\\\"date\\\": item.date, \\\"category\\\": item_category, \\\"item_name\\\": item.consultation_item, \\\"quantity\\\": 1, \\\"item_rate\\\": item.rate, \\\"amount\\\": item.rate  }) %}\\r\\n             {% endfor %}\\r\\n        \\r\\n        \\r\\n         <TABLE border=1 style=\\\"width: 100%; border-collapse: collapse; border: 1px grey; margin-bottom: 10px;\\\">\\r\\n            <COLGROUP>\\r\\n               <COL WIDTH=\\\"5%\\\">\\r\\n               <COL WIDTH=\\\"11%\\\">\\r\\n               <COL WIDTH=\\\"25%\\\">\\r\\n               <COL WIDTH=\\\"36%\\\">\\r\\n               <COL WIDTH=\\\"5%\\\">\\r\\n               <COL WIDTH=\\\"8%\\\">\\r\\n               <COL WIDTH=\\\"15%\\\">    \\r\\n            </COLGROUP>\\r\\n            <THEAD style=\\\"background-color: darkgray;\\\">\\r\\n               <TR>\\r\\n                  <TH style=\\\"text-align: center;\\\">&nbsp;</TH>\\r\\n                  <TH style=\\\"text-align: center;\\\">Date</TH>\\r\\n                  <TH style=\\\"text-align: center;\\\">Category</TH>\\r\\n                  <TH style=\\\"text-align: center;\\\">Description</TH>\\r\\n                  <TH style=\\\"text-align: center;\\\">Qty</TH>\\r\\n                  <TH style=\\\"text-align: center;\\\">Rate</TH>\\r\\n                  <TH style=\\\"text-align: center;\\\">Amount</TH>        \\r\\n               </TR>\\r\\n            </THEAD>\\r\\n            <TBODY>\\r\\n               {% set total = [0] %}\\r\\n               {% for item in bill %}\\r\\n                  {% set total = total.append(total.pop() + item.amount) %}\\r\\n                  <TR>\\r\\n                     <TD style=\\\"text-align: center;\\\">{{ loop.index }}</TD>\\r\\n                     <TD style=\\\"text-align: center;\\\">{{ frappe.utils.formatdate(item.date, \\\"dd-MMM-yyyy\\\") }}</TD>\\r\\n                     <TD style=\\\"text-align: left;\\\">{{ item.category }}</TD>\\r\\n                     <TD style=\\\"text-align: left;\\\">{{ item.item_name }}</TD>\\r\\n                     <TD style=\\\"text-align: center;\\\">{{ item.quantity|int }}</TD>\\r\\n                     <TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(item.item_rate) }}</TD>\\r\\n                     <TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(item.amount, precision=0) }}</TD>\\r\\n                  </TR>\\r\\n               {% endfor %}\\r\\n            </TBODY>\\r\\n            <TFOOT>\\r\\n               <TR>\\r\\n                  <TD style=\\\"text-align: center;\\\">&nbsp;</TD>\\r\\n                  <TD style=\\\"text-align: left;\\\" colspan=\\\"5\\\">TOTAL</TD>\\r\\n                  <TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(total[0], precision=0) }}</TD>\\r\\n                  \\r\\n               </TR> \\r\\n            </TFOOT>\\r\\n         </TABLE>\\r\\n      {% endif %}\\r\\n   {% else %}\\r\\n      This appointment is not closed\\r\\n   {% endif %}\\r\\n{% endif %} \"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{###### OPD && IPD INSURANCE ITEMIZED BILL ######}\\r\\n{% if not doc.mode_of_payment %}\\r\\n    {% if doc.status == \\\"Closed\\\" %}\\r\\n        {% set encounter_list = frappe.db.get_all(\\\"Patient Encounter\\\", filters={'appointment' : doc.name }, fields=['name']) %}\\r\\n        {% set encounter_string = (encounter_list[:encounter_list|length]|join(\\\",\\\",attribute=\\\"name\\\")) %}\\r\\n\\r\\n        {% set bill = [] %}\\r\\n        {% if not doc.follow_up %}\\r\\n            \\r\\n            {% set item_rate = get_item_rate(doc.billing_item, doc.company, doc.insurance_subscription) %}\\r\\n            \\r\\n            {##### OPD Consultancy #####}\\r\\n            {% set category = frappe.db.get_value('Item', doc.billing_item, 'item_group') %}\\r\\n            {% set date  = frappe.utils.formatdate(doc.appointment_date, 'dd-mmmm-yyyy') %}\\r\\n            {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": doc.billing_item , \\\"quantity\\\": 1,  'item_rate': item_rate, \\\"amount\\\": item_rate }) %}\\r\\n        {% endif %} \\r\\n\\r\\n        {% if encounter_string %}\\r\\n\\r\\n            {##### LAB TEST #####}\\r\\n            {% set lab_presc = frappe.db.get_all(\\\"Lab Prescription\\\", filters={'parent': ['in', encounter_string], 'prescribe': 0, 'is_not_available_inhouse': 0}, fields=['lab_test_code', 'lab_test_name', 'amount', 'creation']) %}\\r\\n            {% for lab in lab_presc %}\\r\\n                {% set date = frappe.utils.formatdate(lab.creation, 'dd-mmmm-yyyy') %}\\r\\n                {% set item_rate = lab.amount %}\\r\\n                {% set category = frappe.db.get_value(\\\"Lab Test Template\\\", lab.lab_test_code, ['lab_test_group']) %}\\r\\n                {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": lab.lab_test_code , \\\"quantity\\\": 1,  'item_rate': item_rate, \\\"amount\\\": lab.amount }) %}\\r\\n            {% endfor %}\\r\\n            \\r\\n            {##### RADIOLOGY #####}\\r\\n            {% set rad_exams = frappe.db.get_all(\\\"Radiology Procedure Prescription\\\", filters={'parent': ['in', encounter_string], 'prescribe': 0, 'is_not_available_inhouse': 0}, fields=['radiology_examination_template', 'radiology_procedure_name', 'amount', 'creation'] ) %}\\r\\n            {% for rad in rad_exams %}\\r\\n                {% set date = frappe.utils.formatdate(rad.creation, 'dd-mmmm-yyyy') %}\\r\\n                {% set category = frappe.db.get_value(\\\"Radiology Examination Template\\\", rad.radiology_examination_template, ['item_group']) %}\\r\\n                {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": rad.radiology_examination_template , \\\"quantity\\\": 1,  'item_rate': rad.amount, \\\"amount\\\": rad.amount }) %}\\r\\n            {% endfor %}\\r\\n\\r\\n            {##### CLINICAL PROCEDURE #####}\\r\\n            {% set proc_presc = frappe.db.get_all(\\\"Procedure Prescription\\\", filters={'parent': ['in', encounter_string], 'prescribe': 0, 'is_not_available_inhouse': 0}, fields=['procedure', 'procedure_name', 'amount', 'creation'] ) %}\\r\\n            {% for clin in proc_presc %}\\r\\n                {% set date = frappe.utils.formatdate(clin.creation, 'dd-mmmm-yyyy') %}\\r\\n                {% set category = frappe.db.get_value(\\\"Clinical Procedure Template\\\", clin.procedure, ['item_group']) %}\\r\\n                {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": clin.procedure_name , \\\"quantity\\\": 1,  'item_rate': clin.amount, \\\"amount\\\": clin.amount }) %}\\r\\n            {% endfor %}\\r\\n\\r\\n            {##### MEDICATION #####}\\r\\n            {% set drug_presc = frappe.db.get_all(\\\"Drug Prescription\\\", filters={'parent': ['in', encounter_string], 'prescribe': 0, 'is_not_available_inhouse': 0}, fields=['drug_code', 'drug_name', 'amount', 'quantity', 'creation'] ) %}\\r\\n            {% for drug in drug_presc %}\\r\\n                    {% set date = frappe.utils.formatdate(drug.creation, 'dd-mmmm-yyyy') %}\\r\\n                    {% set amount2 = (drug.quantity * drug.amount) %}\\r\\n                    {% set category = frappe.db.get_value(\\\"Medication\\\", drug.drug_code, ['item_group']) %}\\r\\n                    {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": drug.drug_code , \\\"quantity\\\": drug.quantity,  'item_rate': drug.amount, \\\"amount\\\": amount2 }) %}\\r\\n            {% endfor %}\\r\\n\\r\\n            {##### THERAPIES #####}\\r\\n            {% set ther_plan = frappe.db.get_all(\\\"Therapy Plan Detail\\\", filters={'parent': ['in', encounter_string], 'prescribe': 0, 'is_not_available_inhouse': 0}, fields=['therapy_type', 'amount', 'creation'] ) %}\\r\\n            {% for ther in ther_plan %}\\r\\n                    {% set date = frappe.utils.formatdate(ther.creation, 'dd-mmmm-yyyy') %}\\r\\n                    {% set category = frappe.db.get_value(\\\"Therapy Type\\\", ther.therapy_type, ['item_group']) %}\\r\\n                    {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": ther.therapy_type , \\\"quantity\\\": 1,  'item_rate': ther.amount, \\\"amount\\\": ther.amount }) %}\\r\\n            {% endfor %}\\r\\n\\r\\n            {% set inpatient_id_list = frappe.db.get_all('Inpatient Record', filters={'admission_encounter': ['in', encounter_string]}, fields=['name'], page_length=1) %}\\r\\n            \\r\\n            {% if  inpatient_id_list%}\\r\\n                {% set inpatient_id = inpatient_id_list[0].name %}\\r\\n\\r\\n                {##### IPD BED CHARGES #####}\\r\\n                {% set bed_charges = frappe.db.get_all(\\\"Inpatient Occupancy\\\", filters={'is_confirmed': 1, 'parent': inpatient_id}, fields=['check_in', 'service_unit', \\\"amount\\\"], order_by='check_in asc') %}    \\r\\n                {% if bed_charges %}\\r\\n                    {% for item in bed_charges %}\\r\\n                        {% set hsu = frappe.db.get_value('Healthcare Service Unit', item.service_unit, 'service_unit_type') %}\\r\\n                        {% set item_category = frappe.db.get_value('Healthcare Service Unit Type', hsu, 'item_group') %}\\r\\n                        {## {% set item_rate = get_item_rate(hsu, doc.company, doc.insurance_subscription) %} ##}\\r\\n                        {% set _ = bill.append({\\\"date\\\": item.check_in, \\\"category\\\": item_category, \\\"item_name\\\": hsu, \\\"quantity\\\": 1, 'item_rate': item.amount, \\\"amount\\\": item.amount }) %}\\r\\n                    {% endfor %}\\r\\n                {% endif %}\\r\\n\\r\\n                {##### IPD BED CONS #####}\\r\\n                {% set ipd_cons = frappe.db.get_all(\\\"Inpatient Consultancy\\\", filters={'is_confirmed': 1, 'parent': inpatient_id}, fields=['date', 'consultation_item','rate'], order_by='date asc') %}\\r\\n                {% if ipd_cons %}\\r\\n                    {% for item in ipd_cons %}\\r\\n                        {% set item_category = frappe.db.get_value('Item', item.consultation_item, 'item_group') %}\\r\\n                        {% set _ = bill.append({\\\"date\\\": item.date, \\\"category\\\": item_category, \\\"item_name\\\": item.consultation_item, \\\"quantity\\\": 1, 'item_rate': item.rate, \\\"amount\\\": item.rate }) %}\\r\\n                    {% endfor %}\\r\\n                {% endif %}\\r\\n            {% endif %}\\r\\n\\r\\n            <TABLE border=1 style=\\\"width: 100%; border-collapse: collapse; border: 1px grey; margin-bottom: 10px;\\\">\\r\\n                <COLGROUP>\\r\\n                    <COL WIDTH=\\\"5%\\\">\\r\\n                    <COL WIDTH=\\\"11%\\\">\\r\\n                    <COL WIDTH=\\\"25%\\\">\\r\\n                    <COL WIDTH=\\\"36%\\\">\\r\\n                    <COL WIDTH=\\\"5%\\\">\\r\\n                    <COL WIDTH=\\\"8%\\\">\\r\\n                    <COL WIDTH=\\\"15%\\\">\\r\\n                </COLGROUP>\\r\\n                <THEAD style=\\\"background-color: darkgray;\\\">\\r\\n                    <TR>\\r\\n                        <TH style=\\\"text-align: center;\\\">&nbsp;</TH>\\r\\n                        <TH style=\\\"text-align: center;\\\">Date</TH>\\r\\n                        <TH style=\\\"text-align: center;\\\">Category</TH>\\r\\n                        <TH style=\\\"text-align: center;\\\">Description</TH>\\r\\n                        <TH style=\\\"text-align: center;\\\">Qty</TH>\\r\\n                        <TH style=\\\"text-align: center;\\\">Rate</TH>\\r\\n                        <TH style=\\\"text-align: center;\\\">Amount</TH>\\r\\n                    </TR>\\r\\n                </THEAD>\\r\\n\\r\\n                <TBODY>\\r\\n                    {% set total = [0] %}\\r\\n                    {% for item in bill %}\\r\\n                      {% set total = total.append(total.pop() + item.amount) %}\\r\\n                        <TR>\\r\\n                            <TD style=\\\"text-align: center;\\\">\\r\\n                                {{ loop.index }}\\r\\n                            </TD>\\r\\n                            <TD style=\\\"text-align: center;\\\">\\r\\n                                {{frappe.utils.formatdate(item.date, \\\"dd-MMM-YYYY\\\") }}\\r\\n                            </TD>\\r\\n                            <TD style=\\\"text-align: left;\\\">\\r\\n                                {{ item.category }}\\r\\n                            </TD>\\r\\n                            <TD style=\\\"text-align: left;\\\">\\r\\n                                {{ item.item_name }}\\r\\n                            </TD>\\r\\n                            <TD style=\\\"text-align: center;\\\">\\r\\n                                {{ item.quantity|int }}\\r\\n                            </TD>\\r\\n                            <TD style=\\\"text-align: right;\\\">\\r\\n                                {{ frappe.utils.fmt_money(item.item_rate, precision=0) }}\\r\\n                            </TD>\\r\\n                            <TD style=\\\"text-align: right;\\\">\\r\\n                                {{ frappe.utils.fmt_money(item.amount, precision=0) }}\\r\\n                            </TD>\\r\\n                        </TR>\\r\\n                    {% endfor %}\\r\\n                </TBODY>\\r\\n\\r\\n                <TFOOT>\\r\\n                   <TR>\\r\\n                      <TD style=\\\"text-align: center;\\\">&nbsp;</TD>\\r\\n                      <TD style=\\\"text-align: left;\\\" colspan=\\\"5\\\">TOTAL</TD>\\r\\n                      <TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(total[0], precision=0) }}</TD>\\r\\n                      \\r\\n                   </TR> \\r\\n                </TFOOT>\\r\\n            </TABLE>\\r\\n        {% endif %}\\r\\n    {% else %}\\r\\n        This appointment is not closed\\r\\n    {% endif %}\\r\\n{% endif %}\"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"<p class=\\\"text-center\\\">Printed By: <b>{{ frappe.db.get_value(\\\"User\\\", frappe.session.user, \\\"full_name\\\") }}</b></p>\"}]",
 "idx": 0,
 "line_breaks": 0,
 "modified": "2021-10-22 09:27:35.002483",
 "modified_by": "Administrator",
 "module": "Hms Tz",
 "name": "Itemized Bill Combined",
 "owner": "info@aakvatech.com",
 "print_format_builder": 1,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}